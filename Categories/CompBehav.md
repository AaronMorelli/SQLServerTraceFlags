# Compilation (Behavioral)

(Reminder: [Official BOL location](http://technet.microsoft.com/en-us/library/ms188396.aspx))

See also: 

TODO: divide into sections? (e.g. a section on all the flags related to sorting for IO perf)


## Functionality Toggles

| Flag | Description | Links |
| ---------- | ----------- | -------- |
| 2329 | Disables "Few Outer Rows" optimization | [Dima](http://www.queryprocessor.com/few-outer-rows-optimization/) | 
| 2332 | PWhite: "Force DML Request Sort (CUpdUtil::FDemandRowsSortedForPerformance)" | [PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/01/26/optimizing-t-sql-queries-that-change-data.aspx) | 
| 2335 | Causes the optimizer to generate plans that are "more conservative in terms of memory consumption when executing the query." KB describes scenario where large values of "max server memory" may lead to inefficient plans. | [2413549](http://support.microsoft.com/kb/2413549); [SE (Paul White)](http://dba.stackexchange.com/questions/53726/difference-in-execution-plans-on-uat-and-prod-server) | 
| 2340 | (related to 8744 and 9115) Dima: "Disable Nested Loops Implicit Batch Sort on the Post Optimization Rewrite Phase." | [2009160](http://support.microsoft.com/kb/2009160); [Dima](http://www.queryprocessor.com/batch-sort-and-nested-loops/); [CSS](http://blogs.msdn.com/b/psssql/archive/2010/01/11/high-cpu-after-upgrading-to-sql-server-2005-from-2000-due.aspx) | 
| 2441 | Enables the use of a hash join for joins to column store indexes even when the join clause would normally be removed "during query normalization". | [3146123](https://support.microsoft.com/en-us/kb/3146123) | 
| 7359 | Disables the bitmap associated with hash matching. This bitmap is used for "bit-vector filtering" and can reduce the amount of data written to TempDB during hash spills. | [Dima](http://www.queryprocessor.com/hash-join-execution-internals/) | 
| 7470 | KB: "Makes SQL Server consider internal data management memory overhead when calculating required memory for sort." Can help avoid sort spills to tempdb when the estimate is otherwise accurate. | [3088480](https://support.microsoft.com/en-us/kb/3088480) | 
| 7497 | Full behavior and intended purpose unknown, but the PWhite post uses it in concert with 7498 to disable "optimized bitmaps". | [PWhite](http://sqlperformance.com/2015/11/sql-plan/hash-joins-on-nullable-columns) | 
| 7498 | Full behavior and intended purpose unknown, but the PWhite post uses it in concert with 7498 to disable "optimized bitmaps". | [PWhite](http://sqlperformance.com/2015/11/sql-plan/hash-joins-on-nullable-columns) | 
| 8602 | Ignore index hints that are specified in query/procedure. | [SiebelPDF](http://download.microsoft.com/download/6/e/5/6e52bf39-0519-42b7-b806-c32905f4a066/eim_perf_flowchart_final.pdf); [Kalen](http://sqlblog.com/blogs/kalen_delaney/archive/2008/02/26/lost-without-a-trace.aspx) | 
| 8633 | PWhite: "Enable prefetch (CUpdUtil::FPrefetchAllowedForDML and CPhyOp_StreamUpdate::FDoNotPrefetch)" | [PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/01/26/optimizing-t-sql-queries-that-change-data.aspx) | 
| 8649 | Strongly encourages the optimizer to generate parallel plans. (Perhaps by setting the costing for parallel exchange operators to 0.) | [PWhite](http://sqlblog.com/blogs/paul_white/archive/2011/12/23/forcing-a-parallel-query-execution-plan.aspx); [PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/06/17/improving-partitioned-table-join-performance.aspx); [AMachanic](http://sqlblog.com/blogs/adam_machanic/archive/2013/07/11/next-level-parallel-plan-porcing.aspx) | 
| 8671 | Dima: disables the logic that prunes the memo and prevents the optimization process from stopping due to "Good Enough Plan found". Can significantly increase the amount of time, CPU, and memory used in the compilation process. | [Dima](http://www.somewheresomehow.ru/optimizer_unleashed_2/) | 
| 8677 | Skips "Search 1" phase of query optimization, and only Search 0 and Search 2 execute. | [DBally](https://sqlbits.com/Sessions/Event12/Query_Optimizer_Internals_Traceflag_fun) | 
| 8687 | Found a reference to it (via books.google.com) in Ken Henderson’s Guru’s Guide to Transact-SQL, page 503: "Disables query parallelism" | | 
| 8690 | Prevents the optimizer from using “performance spools” (either table or index) in a query plan. | [CSS](https://blogs.msdn.microsoft.com/psssql/2015/12/15/spool-operator-and-trace-flag-8690/); [PWhite](http://dba.stackexchange.com/questions/52552/index-not-making-execution-faster-and-in-some-cases-is-slowing-down-the-query); [AMachanic near the end](http://www.youtube.com/watch?v=_IRWvlSQxS8); [Connect](http://connect.microsoft.com/SQL/feedback/ViewFeedback.aspx?FeedbackID=453982); [2962767](http://support2.microsoft.com/kb/2962767) | 
| 8692 | Force optimizer to use an Eager Spool for Halloween Protection | [PWhite](http://www.sqlperformance.com/2013/02/sql-plan/halloween-problem-part-4); [PWhite](http://sqlperformance.com/2016/03/sql-plan/changes-to-a-writable-partition-may-fail) | 
| 8720 | In SQL 2000, apparently would have the same effect as OPTION(KEEPFIXED PLAN). | [Hanlincrest](http://www.hanlincrest.com/SQLserverStoredProcRecompiles.htm) | 
| 8722 | Disables all "other" (besides index and join) hints. This includes the OPTION clause. From Database-Wiki (but I suspect originally from a Khen book): "By running all three (8602, 8755, and 8722) flags, you can disable all hints in a query." | [SQLMag](http://sqlmag.com/sql-server/investigating-trace-flags); [Database-Wiki](http://database-wiki.com/2012/10/20/documented-sql-server-trace-flags-use-them-cautiously/) | 
| 8738 | (Apparently) disables an optimization where rows are sorted before a Key Lookup operator. (The optimization is meant to promote Sequential IO rather than the random nature of IO from Key Lookups). Note that the context in which this flag is described means that the above description may not be very precise, or even the only use of this flag. | [PWhite](https://answers.sqlperformance.com/questions/603/why-is-the-sort-operator-needed-in-this-plan.html) | 
| 8744 | (Links below) KB: "Disables pre-fetching for the Nested Loops operator." PWhite: "Disable prefetch (CUpdUtil::FPrefetchAllowedForDML)." Dima's article is useful to contrast NL prefetching and 8744 from NL batch sorting and 2340/9115. |  | 
| 8746 | Whatever else it does, one effect is to disable the “rowset sharing” optimization described in the PWhite miniseries. | [PWhite](http://sqlperformance.com/2016/03/sql-plan/changes-to-a-writable-partition-may-fail); [More on Rowset Sharing](http://sqlperformance.com/2015/12/sql-plan/optimizing-update-queries) | 
| 8757 | Skip Trivial Plan optimization, essentially forcing entry into Full optimization for a query. | [PWhite/Dima](http://sqlblog.com/blogs/paul_white/archive/2011/12/23/forcing-a-parallel-query-execution-plan.aspx); [PWhite](http://sqlblog.com/blogs/paul_white/archive/2012/04/28/query-optimizer-deep-dive-part-1.aspx) | 
| 8758 | PWhite desc 1: "A [workaround to the MERGE bug described] is to apply 8758 – unfortunately this disables a number of optimisations, not just the one above, so it’s not really recommended for long term use." PWhite 2: "Disable rewrite to a single operator plan (CPhyOp_StreamUpdate::PqteConvert)" | [PWhite](http://sqlblog.com/blogs/paul_white/archive/2010/08/04/another-interesting-merge-bug.aspx); [PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/01/26/optimizing-t-sql-queries-that-change-data.aspx); | 
| 8780 | Dima: increases the "timeout" value that the optimizer sets to 3072000 transformations. Normally, the optimizer sets its internal timeout value to something based on the complexity of the query. PWhite tweet: "There's never a good reason to use or promote that dangerous flag" | [Dima](http://www.somewheresomehow.ru/optimizer_unleashed_1/) | 
| 8788 | Dima: notes that 8788 appears to have a similar effect on the timeout, but he hasn’t yet been able to determine the difference in effect between 8788 and 8780 | [Dima](http://www.somewheresomehow.ru/optimizer_unleashed_1/) | 
| 8790 | PWhite: "Undocumented trace flag 8790 forces a wide update plan for any data-changing query (remember that a wide update plan is always possible)." | [956718](http://support.microsoft.com/kb/956718/en-us); [PWhite](http://sqlblog.com/blogs/paul_white/archive/2012/12/10/merge-bug-with-filtered-indexes.aspx); [PWhite](http://sqlperformance.com/2014/06/sql-plan/filtered-index-side-effect) | 
| 8795 | PWhite: "Disable DML Request Sort (CUpdUtil::FDemandRowsSortedForPerformance)" | [PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/01/26/optimizing-t-sql-queries-that-change-data.aspx); [PWhite](http://sqlperformance.com/2014/10/t-sql-queries/performance-tuning-whole-plan) | 
| 9059 | (Needs investigation) Turns back behavior to SQL 2000 SP3 after a SP4 installation, this allows the optimizer to choose an index seek when comparing numeric columns or numeric constants that are of different precision or scale; else would have to change schema/code. | [899976](http://support.microsoft.com/kb/899976/en-us) | 
| 9115 | Dima: "Disables both [NLoop Implicit Batch Sort {TF 2340} and NL Prefetching {TF 8744}], and not only on the Post Optimization, but the explicit Sort also." PWhite: "Disable prefetch (CUpdUtil::FPrefetchAllowedForDML)" | [Dima](http://www.queryprocessor.com/batch-sort-and-nested-loops/); [PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/01/26/optimizing-t-sql-queries-that-change-data.aspx); [Halincrest](http://www.hanlincrest.com/SQLServerLockEscalation.htm) | 
| 9130 | Ballantyne SQLBits: "Disable non-sargable pushed predicates." Prohibits the optimizer from pushing residual predicates down into "access method" iterators (i.e. seeks and scans). | [PWhite](http://sqlblog.com/blogs/paul_white/archive/2012/10/15/cardinality-estimation-bug-with-lookups-in-sql-server-2008-onward.aspx); [DBally](http://sqlblogcasts.com/blogs/sqlandthelike/archive/2012/12/06/my-new-favourite-traceflag.aspx); [PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/06/11/hello-operator-my-switch-is-bored.aspx); [Connect](http://connect.microsoft.com/SQLServer/feedback/details/767395/cardinality-estimation-error-with-pushed-predicate-on-a-lookup) | 
| 9347 | A mysterious flag mentioned nowhere else, but referenced in this bugfix KB: "FIX: Can't disable batch mode sorted by session trace flag 9347 or the query hint QUERYTRACEON 9347 in SQL Server 2016". | [3172787](https://support.microsoft.com/en-us/kb/3172787) | 
| 9348 | Sets a row limit (based on cardinality estimates) that controls whether a bulk insert is attempted or not (assuming conditions are met for a bulk insert). Introduced as a workaround for memory errors encountered with bulk insert. | [2998301](http://support2.microsoft.com/kb/2998301) | 
| 9349 | **Doc2016** BOL: "Disables batch mode top sort operator. SQL Server 2016 introduces a new batch mode top sort operator that boosts performance for many analytical queries." | | 
| 9358 | Disables batch-mode sort operations. | [3171555](https://support.microsoft.com/en-us/kb/3171555) | 
| 9453 | Disables Batch Mode in Parallel Columnstore query plans. (Note that a plan using batch mode appears to require a recompile before the TF takes effect). | [Niko](http://www.nikoport.com/2014/07/24/clustered-columnstore-indexes-part-35-trace-flags-query-optimiser-rules/) | 


**8744** Links: 
[920093](http://support.microsoft.com/kb/920093); [Dima](http://www.queryprocessor.com/batch-sort-and-nested-loops/); 
[PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/03/08/execution-plan-analysis-the-mystery-work-table.aspx); 
[PWhite](http://sqlblog.com/blogs/paul_white/archive/2013/01/26/optimizing-t-sql-queries-that-change-data.aspx); 
[PWhite](https://answers.sqlperformance.com/questions/392/there-are-2-identical-worksets-in-question-this-is.html); [Connect](http://connect.microsoft.com/SQLServer/feedback/details/780194/make-dbcc-trace-flags-available-as-option-querytraceon);
